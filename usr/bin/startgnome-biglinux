#!/bin/sh

# Defining the default visual style to be used in applications that use Qt
export QT_STYLE_OVERRIDE=kvantum
export QT_QPA_PLATFORMTHEME=gnome

# # Load screen startbiglive.
# if [[ ! -e /tmp/big_language ]]; then
#     mutter --wayland &
#     #Waiting for mutter
#     while ! wayland-info &> /dev/null; do
#         sleep 0.5
#     done
#     QT_QPA_PLATFORM=wayland startbiglive
#     killall mutter
# fi

# Better font rendering
# FREETYPE_PROPERTIES="cff:no-stem-darkening=0 autofitter:no-stem-darkening=0"

# Force language
if [ "$LANGUAGE" = "" ]; then
    export LANGUAGE=$LANG
fi

# Checks if the shell has already been changed
if [ ! -f "$HOME/.biglinux-shell-changed" ]; then
    biglinux-change-default-shell bash-power
    touch "$HOME/.biglinux-shell-changed"
fi

#Faster AMD GPU
export RADV_PERFTEST=sam,nggc,ext_ms

#Best wine scale
#export WINE_FULLSCREEN_FSR=1
#export WINE_FULLSCREEN_FSR_STRENGTH=3

#OBS Studio game capture with vulkan
if [ -e "/usr/bin/obs-vkcapture" ]; then
    export OBS_USE_EGL=1
    export OBS_VKCAPTURE=1
    export VK_INSTANCE_LAYERS=VK_LAYER_OBS_vkcapture_64:VK_LAYER_VALVE_steam_overlay_64 #Fix MangoHUD overlay
fi

#Keyboard LED
if [ -e "$HOME/.config/ledkeyboard" ]; then
   change-keyboard-led on
fi

# #More cache to 3D
# __GL_SHADER_DISK_CACHE=1
# __GL_SHADER_DISK_CACHE_SKIP_CLEANUP=1


### Execute in LiveCD
if [ -e /usr/bin/startbiglive ]; then
    # Disable gnome-keyring
    # Path to the control file
    control_file="$HOME/.gnome_keyring_unlocked"

    # Check if the script has already been executed
    if [ ! -f "$control_file" ]; then
        # Unlock the existing keyring (assuming there is no password)
        gnome-keyring-daemon --unlock <<< ""

        # Store a test key to set up the default keyring (without a password)
        secret-tool store --label='Default Keyring' keyring default <<< ""

        # Create the control file to prevent the script from being executed again
        touch "$control_file"
    fi

    # Unlock the keyring at login (assuming there is no password)
    gnome-keyring-daemon --unlock <<< "password"

    # Removes unwanted files
    rm -f "$HOME/Empty Bash" "$HOME/Empty Desktop File.desktop" "$HOME/Empty File"

    # Updates user directories
    xdg-user-dirs-update
fi
